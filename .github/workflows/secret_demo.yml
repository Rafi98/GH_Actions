name: Secret Workflow

on:
  push:
    branches:
      - main


  #workflow_dispatch:
   # inputs:
    #  secret_value:
     #   description: 'Secret value input'
      #  required: true

  
jobs:
  #Workflow_inputvalue:
   # runs-on: ubuntu-latest
    #steps:
     # - name: Use Input Secret Value
      #  run: echo "Secret Value is ${{ secrets.MY_SECRET }}"
       # env:
        #  MY_SECRET: ${{ secrets.MY_SECRET }}


  print-secrets:
   runs-on: ubuntu-latest
   steps:
      - name: Secret_Value
        env:
          MY_VAL: ${{ secrets.MY_SECRET }}
        run: |
          import os
          for q in (os.getenv("MY_VAL")):
            print(q)
        shell: python

  Install_gh_CLI:
    runs-on: ubuntu-latest
   
    steps:
    - name: Install gh CLI
      run: |
          # Install gh CLI
          sudo mkdir -p -m 755 /etc/apt/keyrings && wget -qO- https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg > /dev/null \
          && sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg \
          && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
          && sudo apt update \
          && sudo apt install gh -y
      
  login:
    runs-on: ubuntu-latest
    steps:
      - name: Log in to GitHub
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          gh auth login --with-token <<<"${GH_TOKEN}"

      - name: Checkout code
        uses: actions/checkout@v2

      - name: List contents of the directory
        run: ls -al

      - name: Clone repository using gh CLI
        run: |
          gh repo clone Rafi98/GH_Actions GH_Actions
          cd GH_Actions

      - name: Display URL Path
        run: |
          echo "Path of the remote URL: https://github.com/${{ github.repository }}/tree/${{ github.ref }}"

  encrypt_decrypt_secret:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Install GPG
      - name: Install GPG
        run: sudo apt-get update && sudo apt-get install -y gnupg

     # Install OpenSSL
      - name: Install OpenSSL
        run: sudo apt-get update && sudo apt-get install -y openssl

      - name: Install git-crypt
        run: sudo apt-get install -y git-crypt

      - name: Generate symmetric key
        run: git-crypt init -k mykey --symmetric


     # - name: Generate symmetric key
      #  run: git-crypt init --force --symmetric

      - name: Unlock repository with symmetric key
        run: git-crypt unlock GH_Actions/.github/workflows/

        
      - name: Unlock git-crypt
        run: git-crypt unlock

      


      - name: Decrypt files
        run: |
          #providing decrypt value
          git-crypt unlock <<< "mkuYaDjhEhE7dPmrSCR6ng=="

     # - name: Encrypt value
      #  id: encrypt_value
       # run: |
          # Encrypt the value
        #  encrypted_value: $(echo -n "mkuYaDjhEhE7dPmrSCR6ng==" | gh secret encrypt -R Rafi98/GH_Actions -)
         # echo "::set-output name=encrypted_value::$encrypted_value"
      
      - name: Update Secret
        run: |
          # Get the encrypted value from previous step's output
          encrypted_value="${{ steps.encrypt_value.outputs.encrypted_value }}"

          # Update the encrypted value as a secret
          gh secret set MY_SECRET --body "$encrypted_value" --repo Rafi98/GH_Actions

     
 
     
      #- name: Change in Secret Value
       # run: |
        #  gh secret list
                         
          # Retrieve and list existing secrets
          #gh secret list --json | jq -r '.[] | "\(.name): \(.value)"'
          
          # Update the secret with the new value
          #gh secret set -R Rafi98/GH_Actions MY_SECRET -b 'Eleven'

          #gh secret set MY_SECRET -b 'NINE'

          

        
      - name: Display Changed Secret_Value
        env:
          MY_VAL: ${{ secrets.MY_SECRET }}
        run: |
          import os
          for q in (os.getenv("MY_VAL")):
            print(q)
        shell: python







